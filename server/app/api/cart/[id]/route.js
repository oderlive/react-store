"use strict";(()=>{var e={};e.id=613,e.ids=[613],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61299:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{DELETE:()=>p,PATCH:()=>c});var a=r(73278),i=r(45002),o=r(54877),s=r(28707),u=r(46594),d=r(36102);async function c(e,{params:t}){try{let r=Number(t.id),n=await e.json(),a=e.cookies.get("cartToken")?.value;if(!a)return d.NextResponse.json({error:"Cart token not found"});if(!await s._.cartItem.findFirst({where:{id:r}}))return d.NextResponse.json({error:"Cart item not found"});await s._.cartItem.update({where:{id:r},data:{quantity:n.quantity}});let i=await (0,u.y)(a);return d.NextResponse.json(i)}catch(e){return console.log("[CART_PATCH] Server error",e),d.NextResponse.json({message:"Не удалось обновить корзину"},{status:500})}}async function p(e,{params:t}){try{t.id;let r=e.cookies.get("cartToken")?.value;if(!r)return d.NextResponse.json({error:"Cart token not found"});if(!await s._.cartItem.findFirst({where:{id:Number(t.id)}}))return d.NextResponse.json({error:"Cart item not found"});await s._.cartItem.delete({where:{id:Number(t.id)}});let n=await (0,u.y)(r);return d.NextResponse.json(n)}catch(e){return console.log("[CART_DELETE] Server error",e),d.NextResponse.json({message:"Не удалось удалить корзину"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/cart/[id]/route",pathname:"/api/cart/[id]",filename:"route",bundlePath:"app/api/cart/[id]/route"},resolvedPagePath:"C:\\Users\\TEST\\Downloads\\next-pizza-20241005T111532Z-001\\next-pizza\\app\\api\\cart\\[id]\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:g}=l,x="/api/cart/[id]/route";function y(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},54203:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){let n=Reflect.get(e,t,r);return"function"==typeof n?n.bind(e):n}static set(e,t,r,n){return Reflect.set(e,t,r,n)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},28707:(e,t,r)=>{r.d(t,{_:()=>a});var n=r(53524);let a=globalThis.prismaGlobal??new n.PrismaClient},46594:(e,t,r)=>{r.d(t,{y:()=>i});var n=r(28707);let a=e=>(e.ingredients.reduce((e,t)=>e+t.price,0)+e.productItem.price)*e.quantity,i=async e=>{let t=await n._.cart.findFirst({where:{token:e},include:{items:{orderBy:{createdAt:"desc"},include:{productItem:{include:{product:!0}},ingredients:!0}}}});if(!t)return;let r=t.items.reduce((e,t)=>e+a(t),0);return await n._.cart.update({where:{id:t.id},data:{totalAmount:r},include:{items:{orderBy:{createdAt:"desc"},include:{productItem:{include:{product:!0}},ingredients:!0}}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[379,833],()=>r(61299));module.exports=n})();